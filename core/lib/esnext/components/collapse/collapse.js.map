{"version":3,"file":"collapse.js","sourceRoot":"","sources":["../../../../src/components/collapse/collapse.tsx"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2015 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport classNames from \"classnames\";\nimport * as React from \"react\";\n\nimport { AbstractPureComponent2, Classes } from \"../../common\";\nimport { DISPLAYNAME_PREFIX, Props } from \"../../common/props\";\n\n// eslint-disable-next-line deprecation/deprecation\nexport type CollapseProps = ICollapseProps;\n/** @deprecated use CollapseProps */\nexport interface ICollapseProps extends Props {\n    /** Contents to collapse. */\n    children?: React.ReactNode;\n\n    /**\n     * Component to render as the root element.\n     * Useful when rendering a `Collapse` inside a `<table>`, for instance.\n     *\n     * @default \"div\"\n     */\n    component?: React.ElementType;\n\n    /**\n     * Whether the component is open or closed.\n     *\n     * @default false\n     */\n    isOpen?: boolean;\n\n    /**\n     * Whether the child components will remain mounted when the `Collapse` is closed.\n     * Setting to true may improve performance by avoiding re-mounting children.\n     *\n     * @default false\n     */\n    keepChildrenMounted?: boolean;\n\n    /**\n     * The length of time the transition takes, in milliseconds. This must match\n     * the duration of the animation in CSS. Only set this prop if you override\n     * Blueprint's default transitions with new transitions of a different\n     * length.\n     *\n     * @default 200\n     */\n    transitionDuration?: number;\n}\n\nexport interface ICollapseState {\n    /** The state the element is currently in. */\n    animationState: AnimationStates;\n\n    /** The height that should be used for the content animations. This is a CSS value, not just a number. */\n    height: string | undefined;\n\n    /**\n     * The most recent non-zero height (once a height has been measured upon first open; it is undefined until then)\n     */\n    heightWhenOpen: number | undefined;\n}\n\n/**\n * `Collapse` can be in one of six states, enumerated here.\n * When changing the `isOpen` prop, the following happens to the states:\n * isOpen={true}  : CLOSED -> OPEN_START -> OPENING -> OPEN\n * isOpen={false} : OPEN -> CLOSING_START -> CLOSING -> CLOSED\n */\nexport enum AnimationStates {\n    /**\n     * The body is re-rendered, height is set to the measured body height and\n     * the body Y is set to 0.\n     */\n    OPEN_START,\n\n    /**\n     * Animation begins, height is set to auto. This is all animated, and on\n     * complete, the state changes to OPEN.\n     */\n    OPENING,\n\n    /**\n     * The collapse height is set to auto, and the body Y is set to 0 (so the\n     * element can be seen as normal).\n     */\n    OPEN,\n\n    /**\n     * Height has been changed from auto to the measured height of the body to\n     * prepare for the closing animation in CLOSING.\n     */\n    CLOSING_START,\n\n    /**\n     * Height is set to 0 and the body Y is at -height. Both of these properties\n     * are transformed, and then after the animation is complete, the state\n     * changes to CLOSED.\n     */\n    CLOSING,\n\n    /**\n     * The contents of the collapse is not rendered, the collapse height is 0,\n     * and the body Y is at -height (so that the bottom of the body is at Y=0).\n     */\n    CLOSED,\n}\n\n/**\n * Collapse component.\n *\n * @see https://blueprintjs.com/docs/#core/components/collapse\n */\nexport class Collapse extends AbstractPureComponent2<CollapseProps, ICollapseState> {\n    public static displayName = `${DISPLAYNAME_PREFIX}.Collapse`;\n\n    public static defaultProps: Partial<CollapseProps> = {\n        component: \"div\",\n        isOpen: false,\n        keepChildrenMounted: false,\n        transitionDuration: 200,\n    };\n\n    public static getDerivedStateFromProps(props: CollapseProps, state: ICollapseState) {\n        const { isOpen } = props;\n        const { animationState } = state;\n\n        if (isOpen) {\n            switch (animationState) {\n                case AnimationStates.OPEN:\n                    // no-op\n                    break;\n                case AnimationStates.OPENING:\n                    // allow Collapse#onDelayedStateChange() to handle the transition here\n                    break;\n                default:\n                    return { animationState: AnimationStates.OPEN_START };\n            }\n        } else {\n            switch (animationState) {\n                case AnimationStates.CLOSED:\n                    // no-op\n                    break;\n                case AnimationStates.CLOSING:\n                    // allow Collapse#onDelayedStateChange() to handle the transition here\n                    break;\n                default:\n                    // need to set an explicit height so that transition can work\n                    return {\n                        animationState: AnimationStates.CLOSING_START,\n                        height: `${state.heightWhenOpen}px`,\n                    };\n            }\n        }\n\n        return null;\n    }\n\n    public state: ICollapseState = {\n        animationState: this.props.isOpen ? AnimationStates.OPEN : AnimationStates.CLOSED,\n        height: undefined,\n        heightWhenOpen: undefined,\n    };\n\n    // The element containing the contents of the collapse.\n    private contents: HTMLElement | null = null;\n\n    public render() {\n        const isContentVisible = this.state.animationState !== AnimationStates.CLOSED;\n        const shouldRenderChildren = isContentVisible || this.props.keepChildrenMounted;\n        const displayWithTransform = isContentVisible && this.state.animationState !== AnimationStates.CLOSING;\n        const isAutoHeight = this.state.height === \"auto\";\n\n        const containerStyle = {\n            height: isContentVisible ? this.state.height : undefined,\n            overflowY: isAutoHeight ? \"visible\" : undefined,\n            // transitions don't work with height: auto\n            transition: isAutoHeight ? \"none\" : undefined,\n        };\n\n        const contentsStyle = {\n            // only use heightWhenOpen while closing\n            transform: displayWithTransform ? \"translateY(0)\" : `translateY(-${this.state.heightWhenOpen}px)`,\n            // transitions don't work with height: auto\n            transition: isAutoHeight ? \"none\" : undefined,\n        };\n\n        return React.createElement(\n            this.props.component!,\n            {\n                className: classNames(Classes.COLLAPSE, this.props.className),\n                style: containerStyle,\n            },\n            <div\n                className={Classes.COLLAPSE_BODY}\n                ref={this.contentsRefHandler}\n                style={contentsStyle}\n                aria-hidden={!isContentVisible}\n            >\n                {shouldRenderChildren ? this.props.children : null}\n            </div>,\n        );\n    }\n\n    public componentDidMount() {\n        this.forceUpdate();\n        // HACKHACK: this should probably be done in getSnapshotBeforeUpdate\n        /* eslint-disable react/no-did-mount-set-state */\n        if (this.props.isOpen) {\n            this.setState({ animationState: AnimationStates.OPEN, height: \"auto\" });\n        } else {\n            this.setState({ animationState: AnimationStates.CLOSED, height: \"0px\" });\n        }\n        /* eslint-disable react/no-did-mount-set-state */\n    }\n\n    public componentDidUpdate() {\n        if (this.contents == null) {\n            return;\n        }\n\n        const { transitionDuration } = this.props;\n        const { animationState } = this.state;\n\n        if (animationState === AnimationStates.OPEN_START) {\n            const { clientHeight } = this.contents;\n            this.setState({\n                animationState: AnimationStates.OPENING,\n                height: `${clientHeight}px`,\n                heightWhenOpen: clientHeight,\n            });\n            this.setTimeout(() => this.onDelayedStateChange(), transitionDuration);\n        } else if (animationState === AnimationStates.CLOSING_START) {\n            const { clientHeight } = this.contents;\n            this.setTimeout(() =>\n                this.setState({\n                    animationState: AnimationStates.CLOSING,\n                    height: \"0px\",\n                    heightWhenOpen: clientHeight,\n                }),\n            );\n            this.setTimeout(() => this.onDelayedStateChange(), transitionDuration);\n        }\n    }\n\n    private contentsRefHandler = (el: HTMLElement | null) => {\n        this.contents = el;\n        if (this.contents != null) {\n            const height = this.contents.clientHeight;\n            this.setState({\n                animationState: this.props.isOpen ? AnimationStates.OPEN : AnimationStates.CLOSED,\n                height: height === 0 ? undefined : `${height}px`,\n                heightWhenOpen: height === 0 ? undefined : height,\n            });\n        }\n    };\n\n    private onDelayedStateChange() {\n        switch (this.state.animationState) {\n            case AnimationStates.OPENING:\n                this.setState({ animationState: AnimationStates.OPEN, height: \"auto\" });\n                break;\n            case AnimationStates.CLOSING:\n                this.setState({ animationState: AnimationStates.CLOSED });\n                break;\n            default:\n                break;\n        }\n    }\n}\n"]}