{"version":3,"file":"portal.js","sourceRoot":"","sources":["../../../../src/components/portal/portal.tsx"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2015 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\n\nimport * as Classes from \"../../common/classes\";\nimport { ValidationMap } from \"../../common/context\";\nimport * as Errors from \"../../common/errors\";\nimport { DISPLAYNAME_PREFIX, Props } from \"../../common/props\";\n\n// eslint-disable-next-line deprecation/deprecation\nexport type PortalProps = IPortalProps;\n/** @deprecated use PortalProps */\nexport interface IPortalProps extends Props {\n    /** Contents to send through the portal. */\n    children: React.ReactNode;\n\n    /**\n     * Callback invoked when the children of this `Portal` have been added to the DOM.\n     */\n    onChildrenMount?: () => void;\n\n    /**\n     * The HTML element that children will be mounted to.\n     *\n     * @default document.body\n     */\n    container?: HTMLElement;\n\n    /**\n     * A list of DOM events which should be stopped from propagating through this portal element.\n     *\n     * @see https://legacy.reactjs.org/docs/portals.html#event-bubbling-through-portals\n     * @see https://github.com/palantir/blueprint/issues/6124\n     */\n    stopPropagationEvents?: Array<keyof HTMLElementEventMap>;\n}\n\nexport interface IPortalState {\n    hasMounted: boolean;\n}\n\n/** @deprecated use PortalLegacyContext */\nexport type IPortalContext = PortalLegacyContext;\nexport interface PortalLegacyContext {\n    /** Additional CSS classes to add to all `Portal` elements in this React context. */\n    blueprintPortalClassName?: string;\n}\n\nconst REACT_CONTEXT_TYPES: ValidationMap<PortalLegacyContext> = {\n    blueprintPortalClassName: (obj: PortalLegacyContext, key: keyof PortalLegacyContext) => {\n        if (obj[key] != null && typeof obj[key] !== \"string\") {\n            return new Error(Errors.PORTAL_CONTEXT_CLASS_NAME_STRING);\n        }\n        return undefined;\n    },\n};\n\n/**\n * Portal component.\n *\n * This component detaches its contents and re-attaches them to document.body.\n * Use it when you need to circumvent DOM z-stacking (for dialogs, popovers, etc.).\n * Any class names passed to this element will be propagated to the new container element on document.body.\n *\n * @see https://blueprintjs.com/docs/#core/components/portal\n */\nexport class Portal extends React.Component<PortalProps, IPortalState> {\n    public static displayName = `${DISPLAYNAME_PREFIX}.Portal`;\n\n    public static contextTypes = REACT_CONTEXT_TYPES;\n\n    public static defaultProps: Partial<PortalProps> = {\n        container: typeof document !== \"undefined\" ? document.body : undefined,\n    };\n\n    public context: PortalLegacyContext = {};\n\n    public state: IPortalState = { hasMounted: false };\n\n    private portalElement: HTMLElement | null = null;\n\n    public render() {\n        // Only render `children` once this component has mounted in a browser environment, so they are\n        // immediately attached to the DOM tree and can do DOM things like measuring or `autoFocus`.\n        // See long comment on componentDidMount in https://reactjs.org/docs/portals.html#event-bubbling-through-portals\n        if (typeof document === \"undefined\" || !this.state.hasMounted || this.portalElement === null) {\n            return null;\n        } else {\n            return ReactDOM.createPortal(this.props.children, this.portalElement);\n        }\n    }\n\n    public componentDidMount() {\n        if (this.props.container == null) {\n            return;\n        }\n        this.portalElement = this.createContainerElement();\n        this.props.container.appendChild(this.portalElement);\n        this.addStopPropagationListeners(this.props.stopPropagationEvents);\n        /* eslint-disable-next-line react/no-did-mount-set-state */\n        this.setState({ hasMounted: true }, this.props.onChildrenMount);\n    }\n\n    public componentDidUpdate(prevProps: PortalProps) {\n        // update className prop on portal DOM element\n        if (this.portalElement != null && prevProps.className !== this.props.className) {\n            maybeRemoveClass(this.portalElement.classList, prevProps.className);\n            maybeAddClass(this.portalElement.classList, this.props.className);\n        }\n\n        if (this.portalElement != null && prevProps.stopPropagationEvents !== this.props.stopPropagationEvents) {\n            this.removeStopPropagationListeners(prevProps.stopPropagationEvents);\n            this.addStopPropagationListeners(this.props.stopPropagationEvents);\n        }\n    }\n\n    public componentWillUnmount() {\n        this.removeStopPropagationListeners(this.props.stopPropagationEvents);\n        this.portalElement?.remove();\n    }\n\n    private createContainerElement() {\n        const container = document.createElement(\"div\");\n        container.classList.add(Classes.PORTAL);\n        maybeAddClass(container.classList, this.props.className);\n        if (this.context != null) {\n            maybeAddClass(container.classList, this.context.blueprintPortalClassName);\n        }\n        return container;\n    }\n\n    private addStopPropagationListeners(eventNames?: Array<keyof HTMLElementEventMap>) {\n        eventNames?.forEach(event => this.portalElement?.addEventListener(event, handleStopProgation));\n    }\n\n    private removeStopPropagationListeners(events?: Array<keyof HTMLElementEventMap>) {\n        events?.forEach(event => this.portalElement?.removeEventListener(event, handleStopProgation));\n    }\n}\n\nfunction maybeRemoveClass(classList: DOMTokenList, className?: string) {\n    if (className != null && className !== \"\") {\n        classList.remove(...className.split(\" \"));\n    }\n}\n\nfunction maybeAddClass(classList: DOMTokenList, className?: string) {\n    if (className != null && className !== \"\") {\n        classList.add(...className.split(\" \"));\n    }\n}\n\nfunction handleStopProgation(e: Event) {\n    e.stopPropagation();\n}\n"]}