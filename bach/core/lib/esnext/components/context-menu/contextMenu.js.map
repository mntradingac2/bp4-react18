{"version":3,"file":"contextMenu.js","sourceRoot":"","sources":["../../../../src/components/context-menu/contextMenu.tsx"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2016 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview This component is DEPRECATED, and the code is frozen.\n * All changes & bugfixes should be made to ContextMenu2 instead.\n */\n\nimport classNames from \"classnames\";\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\n\nimport { AbstractPureComponent2, Classes, Position } from \"../../common\";\nimport { IOverlayLifecycleProps } from \"../overlay/overlay\";\nimport { Popover } from \"../popover/popover\";\nimport { PopperModifiers } from \"../popover/popoverSharedProps\";\n\nexport interface IOffset {\n    left: number;\n    top: number;\n}\n\ninterface IContextMenuState {\n    isOpen: boolean;\n    isDarkTheme: boolean;\n    menu?: JSX.Element;\n    offset?: IOffset;\n    onClose?: () => void;\n}\n\nconst POPPER_MODIFIERS: PopperModifiers = {\n    preventOverflow: { boundariesElement: \"viewport\" },\n};\nconst TRANSITION_DURATION = 100;\n\ntype IContextMenuProps = IOverlayLifecycleProps;\n\n/* istanbul ignore next */\n/**\n * ContextMenu component.\n *\n * @see https://blueprintjs.com/docs/#core/components/context-menu\n * @deprecated use ContextMenu2\n */\nclass ContextMenu extends AbstractPureComponent2<IContextMenuProps, IContextMenuState> {\n    public state: IContextMenuState = {\n        isDarkTheme: false,\n        isOpen: false,\n    };\n\n    public render() {\n        // prevent right-clicking in a context menu\n        const content = <div onContextMenu={this.cancelContextMenu}>{this.state.menu}</div>;\n        const popoverClassName = classNames({ [Classes.DARK]: this.state.isDarkTheme });\n\n        // HACKHACK: workaround until we have access to Popper#scheduleUpdate().\n        // https://github.com/palantir/blueprint/issues/692\n        // Generate key based on offset so a new Popover instance is created\n        // when offset changes, to force recomputing position.\n        const key = this.state.offset === undefined ? \"\" : `${this.state.offset.left}x${this.state.offset.top}`;\n\n        // wrap the popover in a positioned div to make sure it is properly\n        // offset on the screen.\n        /* eslint-disable deprecation/deprecation */\n        return (\n            <div className={Classes.CONTEXT_MENU_POPOVER_TARGET} style={this.state.offset}>\n                <Popover\n                    {...this.props}\n                    backdropProps={{ onContextMenu: this.handleBackdropContextMenu }}\n                    content={content}\n                    enforceFocus={false}\n                    key={key}\n                    hasBackdrop={true}\n                    isOpen={this.state.isOpen}\n                    minimal={true}\n                    modifiers={POPPER_MODIFIERS}\n                    onInteraction={this.handlePopoverInteraction}\n                    position={Position.RIGHT_TOP}\n                    popoverClassName={popoverClassName}\n                    target={<div />}\n                    transitionDuration={TRANSITION_DURATION}\n                />\n            </div>\n        );\n        /* eslint-enable deprecation/deprecation */\n    }\n\n    public show(menu: JSX.Element, offset: IOffset, onClose?: () => void, isDarkTheme = false) {\n        this.setState({ isOpen: true, menu, offset, onClose, isDarkTheme });\n    }\n\n    public hide() {\n        this.state.onClose?.();\n        this.setState({ isOpen: false, onClose: undefined });\n    }\n\n    private cancelContextMenu = (e: React.SyntheticEvent<HTMLDivElement>) => e.preventDefault();\n\n    private handleBackdropContextMenu = (e: React.MouseEvent<HTMLDivElement>) => {\n        // React function to remove from the event pool, useful when using a event within a callback\n        e.persist();\n        e.preventDefault();\n        // wait for backdrop to disappear so we can find the \"real\" element at event coordinates.\n        // timeout duration is equivalent to transition duration so we know it's animated out.\n        this.setTimeout(() => {\n            // retrigger context menu event at the element beneath the backdrop.\n            // if it has a `contextmenu` event handler then it'll be invoked.\n            // if it doesn't, no native menu will show (at least on OSX) :(\n            const newTarget = document.elementFromPoint(e.clientX, e.clientY);\n            const { view, ...newEventInit } = e;\n            newTarget?.dispatchEvent(new MouseEvent(\"contextmenu\", newEventInit));\n        }, TRANSITION_DURATION);\n    };\n\n    private handlePopoverInteraction = (nextOpenState: boolean) => {\n        if (!nextOpenState) {\n            // delay the actual hiding till the event queue clears\n            // to avoid flicker of opening twice\n            this.requestAnimationFrame(() => this.hide());\n        }\n    };\n}\n\nlet contextMenuElement: HTMLElement | undefined;\n// eslint-disable-next-line deprecation/deprecation\nlet contextMenu: ContextMenu | undefined;\n\n/**\n * Show the given menu element at the given offset from the top-left corner of the viewport.\n * The menu will appear below-right of this point and will flip to below-left if there is not enough\n * room onscreen. The optional callback will be invoked when this menu closes.\n *\n * @deprecated use ContextMenu2\n */\nexport function show(menu: JSX.Element, offset: IOffset, onClose?: () => void, isDarkTheme?: boolean) {\n    if (contextMenuElement === undefined) {\n        contextMenuElement = document.createElement(\"div\");\n        contextMenuElement.classList.add(Classes.CONTEXT_MENU);\n        document.body.appendChild(contextMenuElement);\n        /* eslint-disable deprecation/deprecation */\n        contextMenu = ReactDOM.render<IContextMenuProps>(\n            <ContextMenu onClosed={remove} />,\n            contextMenuElement,\n        ) as ContextMenu;\n        /* eslint-enable deprecation/deprecation */\n    }\n\n    contextMenu!.show(menu, offset, onClose, isDarkTheme);\n}\n\n/** Hide the open context menu. */\nexport function hide() {\n    contextMenu?.hide();\n}\n\n/** Return whether a context menu is currently open. */\nexport function isOpen() {\n    return contextMenu != null && contextMenu.state.isOpen;\n}\n\nfunction remove() {\n    if (contextMenuElement != null) {\n        ReactDOM.unmountComponentAtNode(contextMenuElement);\n        contextMenuElement.remove();\n        contextMenuElement = undefined;\n        contextMenu = undefined;\n    }\n}\n"]}